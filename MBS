import streamlit as st
import pandas as pd

# ---------------------------------------------------------
# ã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜
# ---------------------------------------------------------
st.title('ğŸ“¦ å‡ºè·é‡é‡è¨ˆç®—ã‚¢ãƒ—ãƒª')
st.write('è£½å“ã¨ãƒ‘ãƒ¬ãƒƒãƒˆã‚’é¸æŠã—ã¦ã€å‡ºè·æ™‚ã®ç·é‡é‡ã‚’è¨ˆç®—ã—ã¾ã™ã€‚')

# ---------------------------------------------------------
# 1. ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
# ---------------------------------------------------------
# Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
@st.cache_data # ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦é«˜é€ŸåŒ–
def load_data():
    try:
        # è£½å“ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        df_products = pd.read_excel('products.xlsx')
        # ãƒ‘ãƒ¬ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        df_pallets = pd.read_excel('pallets.xlsx')
        return df_products, df_pallets
    except FileNotFoundError:
        return None, None

df_products, df_pallets = load_data()

# ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã‚ãªã‹ã£ãŸå ´åˆã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
if df_products is None or df_pallets is None:
    st.error("ã‚¨ãƒ©ãƒ¼: 'products.xlsx' ã¾ãŸã¯ 'pallets.xlsx' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚")
    st.stop()

# ---------------------------------------------------------
# 2. å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ
# ---------------------------------------------------------

st.header('1. è£½å“ã®é¸æŠ')
# ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼šè£½å“ã‚’é¸ã¶
selected_product_name = st.selectbox(
    'å‹ç•ªã‚’é¸æŠã—ã¦ãã ã•ã„',
    df_products['å‹ç•ª']
)

# é¸æŠã•ã‚ŒãŸè£½å“ã®æƒ…å ±ã‚’å–å¾—
product_info = df_products[df_products['å‹ç•ª'] == selected_product_name].iloc[0]
product_weight = product_info['é‡é‡kg']

st.info(f"é¸æŠä¸­ã®è£½å“é‡é‡: {product_weight} kg / å€‹")

# æ•°å€¤å…¥åŠ›ï¼šæ•°é‡ã‚’å…¥ã‚Œã‚‹
quantity = st.number_input('æ•°é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', min_value=1, value=10, step=1)

st.header('2. ãƒ‘ãƒ¬ãƒƒãƒˆã®é¸æŠ')
# ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼šãƒ‘ãƒ¬ãƒƒãƒˆã‚’é¸ã¶
selected_pallet_name = st.selectbox(
    'ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒ¬ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„',
    df_pallets['ãƒ‘ãƒ¬ãƒƒãƒˆå']
)

# é¸æŠã•ã‚ŒãŸãƒ‘ãƒ¬ãƒƒãƒˆã®æƒ…å ±ã‚’å–å¾—
pallet_info = df_pallets[df_pallets['ãƒ‘ãƒ¬ãƒƒãƒˆå'] == selected_pallet_name].iloc[0]
pallet_weight = pallet_info['é‡é‡kg']

st.info(f"ãƒ‘ãƒ¬ãƒƒãƒˆé‡é‡: {pallet_weight} kg")

# ---------------------------------------------------------
# 3. è¨ˆç®—ã¨çµæœè¡¨ç¤º
# ---------------------------------------------------------
st.markdown('---') # åŒºåˆ‡ã‚Šç·š

# è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
# ç·é‡é‡ = (è£½å“å˜é‡ Ã— æ•°é‡) + ãƒ‘ãƒ¬ãƒƒãƒˆé‡é‡
products_total_weight = product_weight * quantity
total_weight = products_total_weight + pallet_weight

st.header('ğŸ“Š è¨ˆç®—çµæœ')

# çµæœã‚’è¦‹ã‚„ã™ãè¡¨ç¤º
col1, col2, col3 = st.columns(3)

with col1:
    st.metric("è£½å“åˆè¨ˆé‡é‡", f"{products_total_weight:.2f} kg")

with col2:
    st.metric("ãƒ‘ãƒ¬ãƒƒãƒˆé‡é‡", f"{pallet_weight:.2f} kg")

with col3:
    st.metric("ç·å‡ºè·é‡é‡", f"{total_weight:.2f} kg", delta_color="normal")

# ç¢ºèªç”¨ãƒ†ã‚­ã‚¹ãƒˆ
st.success(f"è¨ˆç®—å®Œäº†: {selected_product_name} ã‚’ {quantity} å€‹ã€{selected_pallet_name} ã«è¼‰ã›ãŸå ´åˆã®ç·é‡é‡ã§ã™ã€‚")
